# Project Information - LLM Context Guide

> **Important**: Read this document before processing any prompts to understand the project structure, architecture, and conventions.

## Project Overview

This is a **full-stack job application management system** consisting of two separate but connected applications:

1. **Frontend (team4-job-app-frontend)** - Server-side rendered web application
2. **Backend (team4-job-app-backend)** - RESTful API service

---

## Frontend Application (Current Project)

### Technology Stack
- **Runtime**: Node.js (v18+)
- **Language**: TypeScript with ES Modules
- **Framework**: Express.js (v5.1.0)
- **Templating Engine**: Nunjucks
- **Styling**: TailwindCSS v4.1.14 + DaisyUI v5.1.26
- **HTTP Client**: Axios v1.12.2
- **Code Quality**: Biome v2.2.4 (linting + formatting)
- **Testing**: Vitest v3.2.4
- **Dev Tools**: tsx, chokidar (hot reloading)

### Architecture Pattern
**Service-Oriented Architecture** with clear separation of concerns:
- **Controllers** (`src/controllers/`) - Handle HTTP requests/responses
- **Services** (`src/services/`) - Business logic and API communication
- **Models** (`src/models/`) - TypeScript interfaces/types
- **Views** (`views/`) - Nunjucks templates for rendering HTML
- **Constants** (`src/constants/`) - Shared configuration and options

### Key Features
1. **Server-Side Rendering** - Uses Nunjucks templates, not a SPA
2. **Job Role Management** - List, view details, create job roles
3. **Backend Integration** - Communicates with backend API via JobService
4. **Form Handling** - Server-side form processing with validation
5. **Responsive Design** - TailwindCSS + DaisyUI components

### Directory Structure
```
src/
├── index.ts                    # Main Express app entry point
├── controllers/
│   └── job-controller.ts       # Job-related request handlers
├── services/
│   ├── jobService.ts           # API communication layer
│   ├── interfaces.ts           # Service interfaces
│   └── in-memory-job-role-service.ts  # Fallback/testing service
├── models/
│   ├── job-role.ts             # JobRole interface
│   └── create-job-role.ts      # CreateJobRole DTO
├── constants/
│   └── job-form-options.ts     # Form dropdown options
└── utils.ts                    # Utility functions

views/
├── layout.njk                  # Base template with common structure
├── index.njk                   # Homepage
├── jobs.njk                    # Job listings page
├── job-detail.njk              # Individual job details
├── create-job.njk              # Create job form
└── partials/
    ├── header.njk              # Reusable header component
    └── footer.njk              # Reusable footer component
```

### Environment Configuration
```bash
PORT=3000                       # Frontend server port
API_BASE_URL=http://localhost:8080  # Backend API URL (NOTE: different from backend's actual port)
```

### Available Scripts
- `npm run dev` - Development mode with hot reload (runs CSS build + watch + tsx)
- `npm run build` - Compile TypeScript + build CSS for production
- `npm start` - Run compiled production build
- `npm test` - Run Vitest unit tests
- `npm run lint:fix` - Auto-fix linting/formatting issues
- `npm run check` - Check code quality without fixing

### Key Routes
- `GET /` - Homepage with latest 3 job postings
- `GET /jobs` - All job listings (with error/success message handling)
- `GET /jobs/create` - Create job form
- `POST /jobs/create` - Submit new job (handled by JobController)
- `GET /jobs/:id` - Job details page

### Important Implementation Details

#### 1. JobService Pattern
The `JobService` class in `src/services/jobService.ts` handles all API communication:
```typescript
class JobService {
  constructor(private baseUrl: string) {}
  async getAllJobs(): Promise<JobRole[]>
  async getJobById(id: number): Promise<JobRole>
  async createJob(job: CreateJobRole): Promise<JobRole>
}
```

#### 2. Date Handling
- Backend sends dates as ISO strings
- Frontend converts to JavaScript Date objects
- Display format: `dd/MM/yyyy` using `toLocaleDateString("en-GB")`

#### 3. Form Validation
- Constants defined in `src/constants/job-form-options.ts`:
  - `CAPABILITIES`: Array of valid capability options
  - `BANDS`: Array of valid band/level options
  - `STATUSES`: Array of valid job status options
- Validation happens in controllers before API calls

#### 4. Error Handling
- Uses query parameters for error/success messages: `?error=not-found`, `?success=created`
- Redirects on errors to prevent form resubmission
- Error messages displayed in Nunjucks templates

#### 5. Static Assets
- Compiled CSS: `dist/styles.css` (generated by TailwindCSS)
- Public assets: `public/images/` (Kainos logo, etc.)
- Custom JS: `js/index.js` (optional client-side scripts)

### Code Style (Biome Configuration)
- **Indentation**: 2 spaces
- **Quotes**: Double quotes
- **Semicolons**: Required
- **Line Width**: 100 characters max
- **Arrow Functions**: Parentheses required for single params
- **Trailing Commas**: ES5 style

---

## Backend Application (API Service)

### Technology Stack
- **Runtime**: Node.js (v18+)
- **Language**: TypeScript with ES Modules
- **Framework**: Express.js (v5.1.0)
- **Database**: SQLite with better-sqlite3
- **ORM**: Drizzle ORM v0.44.6
- **Testing**: Vitest + Supertest
- **Code Quality**: Biome v2.2.4

### Architecture Pattern
**Layered Architecture** with repository pattern:
- **Controllers** (`src/controllers/`) - Handle HTTP logic
- **Services** (`src/services/`) - Business logic
- **Repositories** (`src/repositories/`) - Data access layer
- **Validators** (`src/validators/`) - Input validation
- **Routes** (`src/routes/`) - Express route definitions
- **DB Schema** (`src/db/schema.ts`) - Drizzle schema definitions

### Key API Endpoints
```
GET  /                          # Health check
GET  /api/jobs                  # List all jobs
GET  /api/jobs/:id              # Get job by ID
POST /api/jobs                  # Create new job
GET  /api/jobs/status/:status   # Get jobs by status (open/closed)
GET  /api/applications          # List all applications
POST /api/applications          # Submit application
GET  /api/applications/:id      # Get application by ID
GET  /api/applications/job/:jobRoleId  # Get applications for specific job
```

### Environment Configuration
```bash
PORT=3001                       # Backend API server port
DATABASE_URL=./data/database.sqlite  # SQLite database path
```

### Database Schema

#### JobRole Entity
```typescript
{
  id: number;                   // Auto-increment primary key
  name: string;                 // Job title
  location: string;             // Office location
  capability: string;           // Technical capability area
  band: string;                 // Experience level
  closingDate: Date;            // Application deadline
  summary: string;              // Job description
  keyResponsibilities: string;  // Main responsibilities
  status: "open" | "closed";    // Current status
  numberOfOpenPositions: number; // Available slots
}
```

#### Application Entity
```typescript
{
  id: number;                   // Auto-increment primary key
  jobRoleId: number;            // Foreign key to job_roles
  firstName: string;
  lastName: string;
  email: string;
  cvUrl: string;                // URL to uploaded CV
  createdAt: Date;              // Submission timestamp
}
```

### Important Backend Details

1. **Database Initialization**: Run `npm run db:seed` to populate initial job data
2. **CORS**: Wide open (`*`) for development - configure for production
3. **Response Format**: Always wrapped in `{ success: boolean, data: any, count?: number }`
4. **Validation**: Happens in validator layer before service/repository calls
5. **Testing**: Comprehensive unit tests for services and validators

---

## Integration Between Frontend & Backend

### Communication Flow
```
User Browser → Frontend Express Server → JobService (Axios) → Backend API → Database
```

### API URL Mapping
**CRITICAL**: Frontend environment variable points to `http://localhost:8080` but backend runs on port `3001`. This suggests a reverse proxy or the backend should run on 8080 in production.

For local development:
- Frontend: `http://localhost:3000`
- Backend: `http://localhost:3001` or `http://localhost:8080`

### Data Flow Example
1. User visits `/jobs`
2. JobController calls `jobRoleService.getAllJobs()`
3. JobService makes GET request to `${API_BASE_URL}/api/jobs`
4. Backend validates, queries database via repository
5. Backend returns JSON: `{ success: true, data: [...], count: 10 }`
6. JobService extracts data, converts date strings to Date objects
7. Controller formats dates for display and passes to Nunjucks template
8. Nunjucks renders HTML and sends to browser

---

## Common Development Patterns

### Adding a New Feature (Frontend)

1. **Define Type/Interface** in `src/models/`
2. **Add Service Method** in `src/services/` for API calls
3. **Create Controller Method** in `src/controllers/` for request handling
4. **Add Route** in `src/index.ts`
5. **Create Template** in `views/`
6. **Add Tests** in `*.test.ts` files
7. **Run Linter** with `npm run lint:fix`

### Adding a New Feature (Backend)

1. **Update Schema** in `src/db/schema.ts`
2. **Generate Migration** with `npm run db:generate`
3. **Create Validator** in `src/validators/`
4. **Create Repository** in `src/repositories/`
5. **Create Service** in `src/services/`
6. **Create Controller** in `src/controllers/`
7. **Add Route** in `src/routes/`
8. **Write Tests** for all layers
9. **Apply Schema** with `npm run db:push`

---

## Testing Philosophy

- **Frontend**: Integration tests for services, unit tests for utilities
- **Backend**: Unit tests for validators, services, integration tests for API endpoints
- **Test Framework**: Vitest (Jest-compatible)
- **Run Tests**: `npm test` (watch mode) or `npm run test:run` (single run)

---

## Important Conventions

### Naming
- **Files**: kebab-case (`job-controller.ts`)
- **Classes**: PascalCase (`JobController`)
- **Interfaces**: PascalCase (`JobRole`)
- **Functions/Variables**: camelCase (`getAllJobs`)
- **Constants**: UPPER_SNAKE_CASE (`API_BASE_URL`)

### Import Paths
- **MUST** use `.js` extension for local imports even though files are `.ts`
- Example: `import { JobService } from "./services/jobService.js";`
- This is required for ES Modules in TypeScript

### Async/Await
- Prefer `async/await` over `.then()` chains
- Always handle errors with try/catch
- Express handlers can be async (Express 5+)

### Type Safety
- NO `any` types unless absolutely necessary
- Use interfaces for data structures
- Use type annotations for function parameters and return types

---

## Common Pitfalls to Avoid

1. **Port Confusion**: Frontend runs on 3000, backend on 3001 (or 8080)
2. **API_BASE_URL Mismatch**: Check `.env` file configuration
3. **Date Serialization**: Backend sends ISO strings, frontend must parse
4. **CORS Issues**: Backend must have CORS enabled for frontend calls
5. **Database Not Seeded**: Run `npm run db:seed` in backend before first use
6. **Import Extensions**: Always use `.js` for imports, not `.ts`
7. **Build Before Run**: Production requires `npm run build` before `npm start`

---

## When Working on This Project

### Questions to Ask First
1. Which app am I modifying? (Frontend or Backend)
2. Does this change require database modifications?
3. Will this affect the API contract between frontend/backend?
4. Do existing tests need updates?
5. Are there new dependencies required?

### Before Making Changes
1. Check if similar functionality already exists
2. Review relevant service/controller/repository code
3. Understand the data flow from database → API → frontend → template
4. Check existing tests for usage examples

### After Making Changes
1. Run `npm run check` for linting
2. Run `npm test` to ensure tests pass
3. Test in browser (frontend) or with curl/Postman (backend)
4. Check console for errors
5. Update relevant documentation

---

## Quick Reference Commands

### Frontend
```bash
npm run dev           # Start development server
npm run build         # Build for production  
npm test              # Run tests
npm run lint:fix      # Fix code quality issues
```

### Backend
```bash
npm run dev           # Start API server
npm run db:seed       # Populate database
npm run db:studio     # View database in browser
npm test              # Run tests
npm run lint:fix      # Fix code quality issues
```

---

## Current Project State

- **Status**: Active development
- **Branch**: `add-instructions` (feature branch)
- **Recent Work**: Creating documentation and project instructions
- **Known Issues**: Check GitHub issues for open tasks

---

## Additional Resources

- Frontend README: `team4-job-app-frontend/README.md`
- Backend README: `team4-job-app-backend/README.md`
- Biome Configuration: `biome.json` (in both projects)
- TypeScript Config: `tsconfig.json` (in both projects)
- Database Schema: `team4-job-app-backend/src/db/schema.ts`

---

**Last Updated**: October 9, 2025
